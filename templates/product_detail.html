{% extends "base.html" %}

{% block title %}{{ product.name_ar }} - DecluxDZ{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('index') }}">الرئيسية</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('shop') }}">المتجر</a></li>
            <li class="breadcrumb-item active">{{ product.name_ar }}</li>
        </ol>
    </nav>

    <div class="row">
        <!-- Product Images -->
        <div class="col-lg-6 mb-4">
            <div class="product-gallery">
                {% if product.image_url %}
                <img src="{{ url_for('uploaded_file', filename=product.image_url) }}" 
                     class="main-product-image img-fluid rounded mb-3" 
                     alt="{{ product.name_ar }}"
                     onerror="this.src='https://via.placeholder.com/500x400?text=صورة+غير+متوفرة'">
                {% else %}
                <img src="https://via.placeholder.com/500x400?text={{ product.name_ar }}" 
                     class="main-product-image img-fluid rounded mb-3" 
                     alt="{{ product.name_ar }}">
                {% endif %}

                <!-- Additional Images -->
                {% if additional_images %}
                <div class="row g-2">
                    <div class="col-3">
                        <img src="{{ url_for('uploaded_file', filename=product.image_url) }}" 
                             class="product-thumbnail img-fluid rounded active" 
                             alt="{{ product.name_ar }}"
                             data-full-image="{{ url_for('uploaded_file', filename=product.image_url) }}">
                    </div>
                    {% for image in additional_images %}
                    <div class="col-3">
                        <img src="{{ url_for('uploaded_file', filename=image) }}" 
                             class="product-thumbnail img-fluid rounded" 
                             alt="{{ product.name_ar }}"
                             data-full-image="{{ url_for('uploaded_file', filename=image) }}">
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Product Info -->
        <div class="col-lg-6">
            <div class="product-info">
                <h1 class="display-5 fw-bold text-primary mb-3">{{ product.name_ar }}</h1>
                
                {% if product.category %}
                <p class="text-muted mb-3">
                    <i class="fas fa-tag me-2"></i>
                    {{ product.category.name_ar }}
                </p>
                {% endif %}

                <div class="product-detail-price mb-4">
                    {{ "{:,.0f}".format(product.price) }} دج
                </div>

                <div class="mb-4">
                    <span class="badge fs-6 {{ 'bg-success' if product.in_stock else 'bg-danger' }} mb-3">
                        {% if product.in_stock %}
                        <i class="fas fa-check-circle me-1"></i> متوفر
                        {% else %}
                        <i class="fas fa-times-circle me-1"></i> غير متوفر
                        {% endif %}
                    </span>
                </div>

                <!-- Quantity and Add to Cart -->
                {% if product.in_stock %}
                <div class="row g-3 mb-4">
                    <div class="col-auto">
                        <label for="quantity" class="form-label fw-bold">الكمية:</label>
                        <div class="input-group" style="width: 130px;">
                            <button class="btn btn-outline-secondary quantity-decrease" type="button">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input type="number" class="form-control quantity-input text-center" 
                                   id="quantity" value="1" min="1">
                            <button class="btn btn-outline-secondary quantity-increase" type="button">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="d-grid gap-2 mb-4">
                    <form method="POST" action="{{ url_for('add_to_cart') }}">
                        <input type="hidden" name="product_id" value="{{ product.id }}">
                        <input type="hidden" name="quantity" id="hidden-quantity" value="1">
                        <button type="submit" class="btn btn-primary btn-lg w-100 add-to-cart-btn" 
                                data-product-id="{{ product.id }}" data-quantity="1">
                            <i class="fas fa-cart-plus me-2"></i>
                            أضف إلى السلة
                        </button>
                    </form>
                </div>
                {% else %}
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    هذا المنتج غير متوفر حالياً
                </div>
                {% endif %}

                <!-- Product Description -->
                {% if product.description_ar %}
                <div class="mb-4">
                    <h5 class="fw-bold mb-3">وصف المنتج</h5>
                    <div class="text-muted">
                        {{ product.description_ar|replace('\n', '<br>')|safe }}
                    </div>
                </div>
                {% endif %}

                <!-- Product Features -->
                <div class="mb-4">
                    <h5 class="fw-bold mb-3">مميزات المنتج</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            جودة عالية ومقاوم للرطوبة
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            سهل التركيب والصيانة
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            تصميم أنيق وعصري
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-truck text-primary me-2"></i>
                            توصيل مجاني لجميع الولايات
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Related Products -->
    {% if related_products %}
    <section class="mt-5">
        <h3 class="fw-bold text-primary mb-4">منتجات ذات صلة</h3>
        <div class="row g-4">
            {% for related_product in related_products %}
            <div class="col-lg-3 col-md-6">
                <div class="card h-100">
                    {% if related_product.image_url %}
                    <img src="{{ url_for('uploaded_file', filename=related_product.image_url) }}" 
                         class="card-img-top" 
                         alt="{{ related_product.name_ar }}"
                         style="height: 200px; object-fit: cover;"
                         onerror="this.src='https://via.placeholder.com/300x200?text=صورة+غير+متوفرة'">
                    {% else %}
                    <img src="https://via.placeholder.com/300x200?text={{ related_product.name_ar }}" 
                         class="card-img-top" 
                         alt="{{ related_product.name_ar }}"
                         style="height: 200px; object-fit: cover;">
                    {% endif %}
                    
                    <div class="card-body d-flex flex-column">
                        <h6 class="card-title">{{ related_product.name_ar }}</h6>
                        <div class="mt-auto">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="fw-bold text-primary">{{ "{:,.0f}".format(related_product.price) }} دج</span>
                                <span class="badge {{ 'bg-success' if related_product.in_stock else 'bg-danger' }}">
                                    {{ 'متوفر' if related_product.in_stock else 'غير متوفر' }}
                                </span>
                            </div>
                            <a href="{{ url_for('product_detail', id=related_product.id) }}" 
                               class="btn btn-outline-primary btn-sm w-100">
                                عرض المنتج
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</div>

<style>
.product-thumbnail {
    cursor: pointer;
    transition: opacity 0.3s ease;
    border: 2px solid transparent;
}

.product-thumbnail:hover {
    opacity: 0.8;
}

.product-thumbnail.active {
    border-color: var(--primary-color);
}

.main-product-image {
    transition: opacity 0.3s ease;
}

.quantity-input::-webkit-outer-spin-button,
.quantity-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

.quantity-input[type=number] {
    -moz-appearance: textfield;
    appearance: textfield;
}
</style>

<script>
// Quantity controls
document.addEventListener('DOMContentLoaded', function() {
    const quantityInput = document.getElementById('quantity');
    const hiddenQuantityInput = document.getElementById('hidden-quantity');
    const decreaseBtn = document.querySelector('.quantity-decrease');
    const increaseBtn = document.querySelector('.quantity-increase');
    
    // Update hidden input when quantity changes
    quantityInput.addEventListener('input', function() {
        hiddenQuantityInput.value = this.value;
    });
    
    // Decrease quantity
    decreaseBtn.addEventListener('click', function() {
        const currentValue = parseInt(quantityInput.value);
        if (currentValue > 1) {
            quantityInput.value = currentValue - 1;
            hiddenQuantityInput.value = currentValue - 1;
        }
    });
    
    // Increase quantity
    increaseBtn.addEventListener('click', function() {
        const currentValue = parseInt(quantityInput.value);
        quantityInput.value = currentValue + 1;
        hiddenQuantityInput.value = currentValue + 1;
    });
    
    // Image gallery functionality
    const thumbnails = document.querySelectorAll('.product-thumbnail');
    const mainImage = document.querySelector('.main-product-image');
    
    thumbnails.forEach(thumbnail => {
        thumbnail.addEventListener('click', function() {
            // Remove active class from all thumbnails
            thumbnails.forEach(t => t.classList.remove('active'));
            // Add active class to clicked thumbnail
            this.classList.add('active');
            // Update main image
            const fullImageUrl = this.getAttribute('data-full-image');
            mainImage.src = fullImageUrl;
        });
    });
});
</script>
{% endblock %}